<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>WITH Queries (Common Table Expressions) - DevOps with Dimas Maryanto</title>
<meta name="description" content="Hai semuanya, di materi kali ini kita akan membahas tentang Common Table Expression yaitu menggunakan WITH Queries pada PostgreSQL. Karena pembahasan kali ini akan lumayan panjang jadi kita akan bagi-bagi menjadi beberapa bagian diataranya:     Select in WITH   More details using Select in WITH   Recursive Queries   Search order   Cycle Detection   Ok langsung aja kita bahas materi yang pertama">


  <meta name="author" content="Dimas Maryanto">
  
  <meta property="article:author" content="Dimas Maryanto">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="DevOps with Dimas Maryanto">
<meta property="og:title" content="WITH Queries (Common Table Expressions)">
<meta property="og:url" content="/posts/rdbms/postgresql/sql/select/04f-with-queries">


  <meta property="og:description" content="Hai semuanya, di materi kali ini kita akan membahas tentang Common Table Expression yaitu menggunakan WITH Queries pada PostgreSQL. Karena pembahasan kali ini akan lumayan panjang jadi kita akan bagi-bagi menjadi beberapa bagian diataranya:     Select in WITH   More details using Select in WITH   Recursive Queries   Search order   Cycle Detection   Ok langsung aja kita bahas materi yang pertama">







  <meta property="article:published_time" content="2022-08-08T15:50:23+07:00">





  

  


<link rel="canonical" href="/posts/rdbms/postgresql/sql/select/04f-with-queries">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Dimas maryanto",
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="DevOps with Dimas Maryanto Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



<script src="/assets/js/jquery/jquery-3.6.4.min.js"></script>
    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt="DevOps with Dimas Maryanto"></a>
        
        <a class="site-title" href="/">
          DevOps with Dimas Maryanto
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/pages/recent-posts/">Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/cources/">Cources</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/roadmaps/">Roadmaps</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/private-class/">Private class</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/discount/">Promo</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <img src="/assets/images/profile.jpeg" alt="Dimas Maryanto" itemprop="image" class="u-photo">
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      Dimas Maryanto
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>I am an <strong>Instructure</strong> at Udemy and 
<strong>Chief Technology Officer</strong> at PT. Tabeldata Informatika</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  <hr>
  

  

  

  
    
    
  
  
  
  <nav class="toc">
    <header>
      <h4 class="nav__title">
        <i class="fas fa-file-alt"></i> 
        On this page
      </h4>
    </header>
    <ul class="toc__menu"><li><a href="#select-in-with">Select in WITH</a></li><li><a href="#more-details-using-select-in-with">More details using Select in WITH</a></li><li><a href="#recursive-queries">Recursive Queries</a></li><li><a href="#search-order">Search order</a></li><li><a href="#cycle-detection">Cycle Detection</a></li></ul>

  </nav>
  
  </div>




  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="WITH Queries (Common Table Expressions)">
    <meta itemprop="description" content="Hai semuanya, di materi kali ini kita akan membahas tentang Common Table Expression yaitu menggunakan WITH Queries pada PostgreSQL. Karena pembahasan kali ini akan lumayan panjang jadi kita akan bagi-bagi menjadi beberapa bagian diataranya:  Select in WITH  More details using Select in WITH  Recursive Queries  Search order  Cycle DetectionOk langsung aja kita bahas materi yang pertama">
    <meta itemprop="datePublished" content="2022-08-08T15:50:23+07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="/posts/rdbms/postgresql/sql/select/04f-with-queries" class="u-url" itemprop="url">WITH Queries (Common Table Expressions)
</a>
          </h1>
          
<p class="page__meta">

  
  
    <a href="/pages/cources/postgres-query" target="_blank" rel="noopener noreferrer">
      <i class="fas fa-link"></i>
      PostgreSQL
    </a>
    <span class="page__meta-sep"></span>
  



  
    
    <span class="page__meta-date">
      <i class="far fa-calendar-alt" aria-hidden="true"></i>
      
      <time datetime="2022-08-08T15:50:23+07:00">August 8, 2022</time>
    </span>
  

  <span class="page__meta-sep"></span>

  
    
    

    <span class="page__meta-readtime">
      <i class="far fa-clock" aria-hidden="true"></i>
      
        15 minute read
      
    </span>
  
    

</p>

        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <div class="text-right">
          <label class="switch">
            <input name="cource-content" onchange="showCourceContent(this.checked)" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>        
        <aside id="cource_contents" style="display: none;" class="sidebar__right">
          
            
            
            
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-Pengenalan PostgreSQL">
        <label class="acordion-item-label" for="content-Pengenalan PostgreSQL">
            Pengenalan PostgreSQL
        </label>
        <div class="acordion-item-content">
            <ul>
            
                
                <li>
                    <a href="/posts/rdbms/postgresql/01-silabus-psql">
                        
                        Silabus - PostgreSQL: Pemul...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/01a-what-is-postgresql">
                        
                        Overview of PostgreSQL Data...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/01b-postgresql-architecture">
                        
                        Architecture of PostgreSQL ...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/01c-postgresql-database">
                        
                        Overview of Object Relation...
                    </a>
                </li>
                
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-Getting started">
        <label class="acordion-item-label" for="content-Getting started">
            Getting started
        </label>
        <div class="acordion-item-content">
            <ul>
            
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02-overview-install-postgres">
                        
                        Overview Installing PostgreSQL
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02a-install-postgresql-windows">
                        
                        Install PostgreSQL for Wind...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02a-install-postgresql-mac">
                        
                        Install PostgreSQL for Mac ...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02a-install-postgresql-linux-ubuntu">
                        
                        Install PostgreSQL for Linu...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02a-install-postgresql-docker">
                        
                        Install PostgreSQL using Do...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02b-use-psql">
                        
                        Using psql as PostgreSQL ed...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02c-use-pgadmin">
                        
                        Using pgAdmin4 as PostgreSQ...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/getting-started/02d-use-third-party-editors">
                        
                        Using thirdparty Editor unt...
                    </a>
                </li>
                
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-SQL - Select Statement">
        <label class="acordion-item-label" for="content-SQL - Select Statement">
            SQL - Select Statement
        </label>
        <div class="acordion-item-content">
            <ul>
            
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03-overview-sql">
                        
                        Overview SQL Select statements
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03a-basic-select-statement">
                        
                        Basic SQL Select statements
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03b-sql-operators">
                        
                        Build-in Operators
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03c-sql-functions">
                        
                        Build-in Functions
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03d-where-clause">
                        
                        Filtering data with WHERE c...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03e-order-by-clause">
                        
                        Sorting rows using ORDER BY...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03f-limit-offset-clause">
                        
                        Limit dan Offset rows
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/03g-quis-section-1">
                        
                        Time your practice (part 1)
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04-overview-more-select-statements">
                        
                        Deep dive into Select State...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04a-single-group-function">
                        
                        Single Row / Group functions
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04b-join-tables">
                        
                        Joined Tables
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04c-subquery">
                        
                        Queries inside a query (sub...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04d-conditional-expression">
                        
                        Conditional Expressions
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04e-combining-queries">
                        
                        Combining Queries (UNION, I...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04f-with-queries">
                        
                        <i class="fas fa-bookmark"></i>
                        
                        WITH Queries (Common Table ...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/select/04g-quis-section-2">
                        
                        Time your practice (part 2)
                    </a>
                </li>
                
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-SQL - Data manipulation">
        <label class="acordion-item-label" for="content-SQL - Data manipulation">
            SQL - Data manipulation
        </label>
        <div class="acordion-item-content">
            <ul>
            
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05-overview-dml">
                        
                        Overview of Data Manipulati...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05a-cud-statement">
                        
                        Basic Create, Update, Delet...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05b-dml-insert">
                        
                        Deep dive into INSERT State...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05c-dml-update">
                        
                        Deep dive into UPDATE State...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05d-dml-delete">
                        
                        Deep dive into DELETE state...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05e-dml-prepared-statement">
                        
                        Prepared Statement in SQL
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05f-dml-cleanup">
                        
                        Cleanup Data from Table
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/dml/05g-quis-section-1">
                        
                        Time your practice (part 3)
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/tcl/06-overview-concurrent-control">
                        
                        Overview of Concurrency Con...
                    </a>
                </li>
                
                <li>
                    <a href="/posts/rdbms/postgresql/sql/tcl/06a-basic-tcl">
                        
                        Getting started with Transa...
                    </a>
                </li>
                
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-SQL - Data definition">
        <label class="acordion-item-label" for="content-SQL - Data definition">
            SQL - Data definition
        </label>
        <div class="acordion-item-content">
            <ul>
            
            <li>
                <a href="#!">Materi belum tersedia</a>
            </li>
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-Study Kasus: Database design (Mapping)">
        <label class="acordion-item-label" for="content-Study Kasus: Database design (Mapping)">
            Study Kasus: Database design (Mapping)
        </label>
        <div class="acordion-item-content">
            <ul>
            
            <li>
                <a href="#!">Materi belum tersedia</a>
            </li>
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-SQL - Indexes">
        <label class="acordion-item-label" for="content-SQL - Indexes">
            SQL - Indexes
        </label>
        <div class="acordion-item-content">
            <ul>
            
            <li>
                <a href="#!">Materi belum tersedia</a>
            </li>
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-SQL - Users Management">
        <label class="acordion-item-label" for="content-SQL - Users Management">
            SQL - Users Management
        </label>
        <div class="acordion-item-content">
            <ul>
            
            <li>
                <a href="#!">Materi belum tersedia</a>
            </li>
            
            </ul>
        </div>
    </div>
</nav>
              
                
                
                



<div class="accordion-container">
    <div class="acordion-item">
        <input type="checkbox" id="content-Type Conversion">
        <label class="acordion-item-label" for="content-Type Conversion">
            Type Conversion
        </label>
        <div class="acordion-item-content">
            <ul>
            
            <li>
                <a href="#!">Materi belum tersedia</a>
            </li>
            
            </ul>
        </div>
    </div>
</nav>
                
                      
          
        </aside>
        
        <p>Hai semuanya, di materi kali ini kita akan membahas tentang Common Table Expression yaitu menggunakan <code class="language-plaintext highlighter-rouge">WITH</code> Queries pada PostgreSQL. Karena pembahasan kali ini akan lumayan panjang jadi kita akan bagi-bagi menjadi beberapa bagian diataranya:</p>

<ol>
  <li>Select in WITH</li>
  <li>More details using Select in WITH</li>
  <li>Recursive Queries</li>
  <li>Search order</li>
  <li>Cycle Detection</li>
</ol>

<p>Ok langsung aja kita bahas materi yang pertama</p>

<!--more-->

<h2 id="select-in-with">Select in WITH</h2>

<p>The <code class="language-plaintext highlighter-rouge">WITH</code> query provides a way to write auxiliary statements for use in a larger query. It helps in breaking down complicated and large queries into simpler forms, which are easily readable. These statements often referred to as Common Table Expressions or CTEs, can be thought of as defining temporary tables that exist just for one query.</p>

<p>The <code class="language-plaintext highlighter-rouge">WITH</code> query being CTE query, is particularly useful when subquery is executed multiple times. It is equally helpful in place of temporary tables. It computes the aggregation once and allows us to reference it by its name (may be multiple times) in the queries.</p>

<p>The basic syntax of <code class="language-plaintext highlighter-rouge">WITH</code> Query is</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">WITH</span> <span class="o">&lt;</span><span class="n">named_query</span><span class="o">&gt;</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="p">...</span>
    <span class="k">from</span> <span class="p">...</span>
    <span class="p">[</span><span class="k">where</span> <span class="p">...]</span>
<span class="p">)</span>
<span class="k">select</span> <span class="p">...</span>
<span class="k">from</span> <span class="p">...</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">named_query</span><span class="o">&gt;</span>
<span class="p">[</span><span class="k">where</span> <span class="p">...</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">named_query</span><span class="o">&gt;</span><span class="p">]</span></code></pre></figure>

<p>Where <code class="language-plaintext highlighter-rouge">&lt;named_query&gt;</code> equal to temporary table with given named. The <code class="language-plaintext highlighter-rouge">&lt;named_query&gt;</code> can be the same as existing table name and will take precedence. You can use data-modifying statements (<code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">UPDATE</code> or <code class="language-plaintext highlighter-rouge">DELETE</code>) in WITH. This allows you to perform several different operations in the same query.</p>

<p>Berikut adalah contoh implementasi querynya:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-simple-with-query.sql"> </script>

<p>Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="n">get_emp_in_dep_hundred</span> <span class="k">as</span> <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>     <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>     <span class="k">from</span> <span class="n">employees</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>     <span class="k">where</span> <span class="n">department_id</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span> <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">commission_pct</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">get_emp_in_dep_hundred</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">limit</span> <span class="mi">5</span><span class="p">;</span>

 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span>  <span class="n">salary</span>  <span class="o">|</span> <span class="n">commission_pct</span> 
<span class="c1">-------------+-------------+----------+----------------</span>
         <span class="mi">108</span> <span class="o">|</span> <span class="n">Nancy</span>       <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>               
         <span class="mi">109</span> <span class="o">|</span> <span class="n">Daniel</span>      <span class="o">|</span>  <span class="mi">9000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>               
         <span class="mi">110</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>  <span class="mi">8200</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>               
         <span class="mi">111</span> <span class="o">|</span> <span class="n">Ismael</span>      <span class="o">|</span>  <span class="mi">7700</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>               
         <span class="mi">112</span> <span class="o">|</span> <span class="n">Jose</span> <span class="n">Manuel</span> <span class="o">|</span>  <span class="mi">7800</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>               
<span class="p">(</span><span class="mi">5</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="more-details-using-select-in-with">More details using Select in WITH</h2>

<p>Sepertinya telah saya jelaskan di section sebelumnya, The <code class="language-plaintext highlighter-rouge">WITH</code> Query pada dasarnya digunakan untuk mem-breakdown complicated queries menjadi lebih simple. berikut contohnya:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">department_id</span>
<span class="k">from</span> <span class="n">employees</span>
<span class="k">where</span> <span class="n">department_id</span> <span class="k">in</span> 
  <span class="p">(</span>
    <span class="k">select</span> <span class="k">distinct</span> <span class="n">department_id</span> <span class="k">as</span> <span class="n">dep_id</span>
    <span class="k">from</span> <span class="n">departments</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">locations</span>
    <span class="k">where</span> <span class="n">country_id</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'UK'</span><span class="p">,</span> <span class="s1">'US'</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="k">and</span> <span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">10000</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">desc</span>
<span class="k">limit</span> <span class="mi">10</span><span class="p">;</span></code></pre></figure>

<p>Jika menggunakan WITH Queries maka seperti berikut implementasinya:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-complex-with-query.sql"> </script>

<p>which displays top 10 employees salary and filter by department location in <code class="language-plaintext highlighter-rouge">US</code> or <code class="language-plaintext highlighter-rouge">UK</code>. jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="n">top10_salaries</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>          <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">department_id</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">from</span> <span class="n">employees</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">where</span> <span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">10000</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">desc</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">limit</span> <span class="mi">10</span><span class="p">),</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="n">department_uk_us</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>          <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">select</span> <span class="k">distinct</span> <span class="n">department_id</span> <span class="k">as</span> <span class="n">dep_id</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">from</span> <span class="n">departments</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                       <span class="k">natural</span> <span class="k">join</span> <span class="n">locations</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">where</span> <span class="n">country_id</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'UK'</span><span class="p">,</span> <span class="s1">'US'</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">top10_salaries</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">where</span> <span class="n">department_id</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">dep_id</span> <span class="k">from</span> <span class="n">department_uk_us</span><span class="p">);</span>

 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span> <span class="o">|</span>  <span class="n">salary</span>  <span class="o">|</span> <span class="n">department_id</span> 
<span class="c1">-------------+------------+----------+---------------</span>
         <span class="mi">100</span> <span class="o">|</span> <span class="n">Steven</span>     <span class="o">|</span> <span class="mi">24000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">90</span>
         <span class="mi">102</span> <span class="o">|</span> <span class="n">Lex</span>        <span class="o">|</span> <span class="mi">17000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">90</span>
         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>      <span class="o">|</span> <span class="mi">17000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">90</span>
         <span class="mi">145</span> <span class="o">|</span> <span class="n">John</span>       <span class="o">|</span> <span class="mi">14000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">80</span>
         <span class="mi">146</span> <span class="o">|</span> <span class="n">Karen</span>      <span class="o">|</span> <span class="mi">13500</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">80</span>
         <span class="mi">205</span> <span class="o">|</span> <span class="n">Shelley</span>    <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>           <span class="mi">110</span>
         <span class="mi">108</span> <span class="o">|</span> <span class="n">Nancy</span>      <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>           <span class="mi">100</span>
         <span class="mi">147</span> <span class="o">|</span> <span class="n">Alberto</span>    <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">80</span>
         <span class="mi">168</span> <span class="o">|</span> <span class="n">Lisa</span>       <span class="o">|</span> <span class="mi">11500</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span>            <span class="mi">80</span>
<span class="p">(</span><span class="mi">9</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<p>Selain itu juga kita bisa membuat two auxiliary statements named <code class="language-plaintext highlighter-rouge">employees_in_dep_90</code> and <code class="language-plaintext highlighter-rouge">top3_salaries</code> dimana the output of <code class="language-plaintext highlighter-rouge">employees_in_dep_90</code> digunakan pada <code class="language-plaintext highlighter-rouge">top3_salaries</code>. seperti berikut querynya:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-auxiliary-with-query.sql"> </script>

<p>Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="n">employees_in_dep_90</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>          <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">from</span> <span class="n">employees</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">where</span> <span class="n">department_id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="p">),</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="n">top3_salaries</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>          <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">from</span> <span class="n">employees_in_dep_90</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">desc</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>              <span class="k">limit</span> <span class="mi">3</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">top3_salaries</span><span class="p">;</span>
 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span> <span class="o">|</span>  <span class="n">salary</span>  
<span class="c1">-------------+------------+----------</span>
         <span class="mi">100</span> <span class="o">|</span> <span class="n">Steven</span>     <span class="o">|</span> <span class="mi">24000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">102</span> <span class="o">|</span> <span class="n">Lex</span>        <span class="o">|</span> <span class="mi">17000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>      <span class="o">|</span> <span class="mi">17000</span><span class="p">.</span><span class="mi">00</span>
<span class="p">(</span><span class="mi">3</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<p>Nah bagaimana? lebih mudah untuk di baca khan dibandingkan kita membuat dengan nested SUB-QUERY.</p>

<h2 id="recursive-queries">Recursive Queries</h2>

<p>The optional <code class="language-plaintext highlighter-rouge">RECURSIVE</code> modifier changes <code class="language-plaintext highlighter-rouge">WITH</code> from a mere syntactic convenience into a feature that accomplishes things not otherwise possible in standard SQL. Using <code class="language-plaintext highlighter-rouge">RECURSIVE</code>, a <code class="language-plaintext highlighter-rouge">WITH</code> query can refer to its own output. A very simple example is this query to sum the integers from <code class="language-plaintext highlighter-rouge">1</code> through <code class="language-plaintext highlighter-rouge">100</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">100</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">t</span><span class="p">;</span></code></pre></figure>

<p>The general form of a recursive WITH query is always a non-recursive term, then UNION (or UNION ALL), then a recursive term, where only the recursive term can contain a reference to the query’s own output. Such a query is executed as follows:</p>

<ol>
  <li>
    <p>Evaluate the non-recursive term. For UNION (but not UNION ALL), discard duplicate rows. Include all remaining rows in the result of the recursive query, and also place them in a temporary working table.</p>
  </li>
  <li>
    <p>So long as the working table is not empty, repeat these steps:</p>
    <ol>
      <li>Evaluate the recursive term, substituting the current contents of the working table for the recursive self-reference. For UNION (but not UNION ALL), discard duplicate rows and rows that duplicate any previous result row. Include all remaining rows in the result of the recursive query, and also place them in a temporary intermediate table.</li>
      <li>Replace the contents of the working table with the contents of the intermediate table, then empty the intermediate table.</li>
    </ol>
  </li>
</ol>

<p>Recursive queries are typically used to deal with hierarchical or tree-structured data. A usefull example is this query to find all the direct and indirect sub-employees of a manager, given only a table that show immediate includes:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-with-query-recursive.sql"> </script>

<p>Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="k">recursive</span> <span class="n">managed_by</span><span class="p">(</span><span class="n">manager_id</span><span class="p">,</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">)</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">our_manager</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">UNION</span> <span class="k">ALL</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                   <span class="k">join</span> <span class="n">managed_by</span> <span class="n">man</span> <span class="k">on</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">man</span><span class="p">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>      <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="o">-#</span>        <span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="o">-#</span>        <span class="n">manager_id</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">managed_by</span><span class="p">;</span>

 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span> <span class="n">manager_id</span> 
<span class="c1">-------------+-------------+------------</span>
         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>        <span class="mi">100</span>
         <span class="mi">108</span> <span class="o">|</span> <span class="n">Nancy</span>       <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">200</span> <span class="o">|</span> <span class="n">Jennifer</span>    <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">203</span> <span class="o">|</span> <span class="n">Susan</span>       <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">204</span> <span class="o">|</span> <span class="n">Hermann</span>     <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">205</span> <span class="o">|</span> <span class="n">Shelley</span>     <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">109</span> <span class="o">|</span> <span class="n">Daniel</span>      <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">110</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">111</span> <span class="o">|</span> <span class="n">Ismael</span>      <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">112</span> <span class="o">|</span> <span class="n">Jose</span> <span class="n">Manuel</span> <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">113</span> <span class="o">|</span> <span class="n">Luis</span>        <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">206</span> <span class="o">|</span> <span class="n">William</span>     <span class="o">|</span>        <span class="mi">205</span>
<span class="p">(</span><span class="mi">12</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="search-order">Search order</h2>

<p>When computing a tree traversal using a recursive query, you might want to order the results in either depth-first or breadth-first order. This can be done by computing an ordering column alongside the other data columns and using that to sort the results at the end. Note that this does not actually control in which order the query evaluation visits the rows; that is as always in SQL implementation-dependent. This approach merely provides a convenient way to order the results afterwards.</p>

<p>To create a depth-first order, we compute for each result row an array of rows that we have visited so far. For example, consider the following query that searches a table tree using a <code class="language-plaintext highlighter-rouge">link</code> field:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">search_tree</span><span class="p">(...</span> <span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="p">...</span> <span class="p">,</span> <span class="n">ARRAY</span><span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="k">column</span><span class="p">]</span>
    <span class="k">FROM</span> <span class="n">tree</span> <span class="n">t</span>
  <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span> <span class="p">...</span> <span class="p">,</span> <span class="n">path</span> <span class="o">||</span> <span class="n">t</span><span class="p">.</span><span class="k">column</span>
    <span class="k">FROM</span> <span class="n">tree</span> <span class="n">t</span><span class="p">,</span> <span class="n">search_tree</span> <span class="n">st</span>
    <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">link</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">search_tree</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">path</span><span class="p">;</span></code></pre></figure>

<p>Here the code:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-with-query-sortable.sql"> </script>

<p>Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="k">recursive</span> <span class="n">managed_by</span><span class="p">(</span><span class="n">manager_id</span><span class="p">,</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">array</span> <span class="p">[</span><span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span><span class="p">]</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">our_manager</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">UNION</span> <span class="k">ALL</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">array</span> <span class="p">[</span><span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">]</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                   <span class="k">join</span> <span class="n">managed_by</span> <span class="n">man</span> <span class="k">on</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">man</span><span class="p">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>      <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">manager_id</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">managed_by</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">order</span> <span class="k">by</span> <span class="n">path</span> <span class="k">desc</span><span class="p">;</span>
 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span> <span class="n">manager_id</span> 
<span class="c1">-------------+-------------+------------</span>
         <span class="mi">206</span> <span class="o">|</span> <span class="n">William</span>     <span class="o">|</span>        <span class="mi">205</span>
         <span class="mi">203</span> <span class="o">|</span> <span class="n">Susan</span>       <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">205</span> <span class="o">|</span> <span class="n">Shelley</span>     <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>        <span class="mi">100</span>
         <span class="mi">108</span> <span class="o">|</span> <span class="n">Nancy</span>       <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">113</span> <span class="o">|</span> <span class="n">Luis</span>        <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">112</span> <span class="o">|</span> <span class="n">Jose</span> <span class="n">Manuel</span> <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">110</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">200</span> <span class="o">|</span> <span class="n">Jennifer</span>    <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">111</span> <span class="o">|</span> <span class="n">Ismael</span>      <span class="o">|</span>        <span class="mi">108</span>
         <span class="mi">204</span> <span class="o">|</span> <span class="n">Hermann</span>     <span class="o">|</span>        <span class="mi">101</span>
         <span class="mi">109</span> <span class="o">|</span> <span class="n">Daniel</span>      <span class="o">|</span>        <span class="mi">108</span>
<span class="p">(</span><span class="mi">12</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<p>Atau selain itu juga kita bisa multiple column order dengan with query recursive seperti berikut:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-with-query-sortable-multi-columns.sql"> </script>

<p>Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="k">recursive</span> <span class="n">managed_by</span><span class="p">(</span><span class="n">manager_id</span><span class="p">,</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">array</span> <span class="p">[</span><span class="k">ROW</span> <span class="p">(</span><span class="n">our_manager</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">salary</span><span class="p">)]</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">our_manager</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">UNION</span> <span class="k">ALL</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">array</span> <span class="p">[</span><span class="k">ROW</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span><span class="p">)]</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                   <span class="k">join</span> <span class="n">managed_by</span> <span class="n">man</span> <span class="k">on</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">man</span><span class="p">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>      <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">manager_id</span><span class="p">,</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">salary</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">managed_by</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">order</span> <span class="k">by</span> <span class="n">path</span> <span class="k">desc</span><span class="p">;</span>
 <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span> <span class="n">manager_id</span> <span class="o">|</span> <span class="n">department_id</span> <span class="o">|</span>  <span class="n">salary</span>  
<span class="c1">-------------+-------------+------------+---------------+----------</span>
         <span class="mi">205</span> <span class="o">|</span> <span class="n">Shelley</span>     <span class="o">|</span>        <span class="mi">101</span> <span class="o">|</span>           <span class="mi">110</span> <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">206</span> <span class="o">|</span> <span class="n">William</span>     <span class="o">|</span>        <span class="mi">205</span> <span class="o">|</span>           <span class="mi">110</span> <span class="o">|</span>  <span class="mi">8300</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">108</span> <span class="o">|</span> <span class="n">Nancy</span>       <span class="o">|</span>        <span class="mi">101</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span> <span class="mi">12000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">109</span> <span class="o">|</span> <span class="n">Daniel</span>      <span class="o">|</span>        <span class="mi">108</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span>  <span class="mi">9000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">110</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>        <span class="mi">108</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span>  <span class="mi">8200</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">112</span> <span class="o">|</span> <span class="n">Jose</span> <span class="n">Manuel</span> <span class="o">|</span>        <span class="mi">108</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span>  <span class="mi">7800</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">111</span> <span class="o">|</span> <span class="n">Ismael</span>      <span class="o">|</span>        <span class="mi">108</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span>  <span class="mi">7700</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">113</span> <span class="o">|</span> <span class="n">Luis</span>        <span class="o">|</span>        <span class="mi">108</span> <span class="o">|</span>           <span class="mi">100</span> <span class="o">|</span>  <span class="mi">6900</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>        <span class="mi">100</span> <span class="o">|</span>            <span class="mi">90</span> <span class="o">|</span> <span class="mi">17000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">204</span> <span class="o">|</span> <span class="n">Hermann</span>     <span class="o">|</span>        <span class="mi">101</span> <span class="o">|</span>            <span class="mi">70</span> <span class="o">|</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">203</span> <span class="o">|</span> <span class="n">Susan</span>       <span class="o">|</span>        <span class="mi">101</span> <span class="o">|</span>            <span class="mi">40</span> <span class="o">|</span>  <span class="mi">6500</span><span class="p">.</span><span class="mi">00</span>
         <span class="mi">200</span> <span class="o">|</span> <span class="n">Jennifer</span>    <span class="o">|</span>        <span class="mi">101</span> <span class="o">|</span>            <span class="mi">10</span> <span class="o">|</span>  <span class="mi">4400</span><span class="p">.</span><span class="mi">00</span>
<span class="p">(</span><span class="mi">12</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="cycle-detection">Cycle Detection</h2>

<p>When working with recursive queries it is important to be sure that the recursive part of the query will eventually return no tuples, or else the query will loop indefinitely. Sometimes, using UNION instead of UNION ALL can accomplish this by discarding rows that duplicate previous output rows. However, often a cycle does not involve output rows that are completely duplicate: it may be necessary to check just one or a few fields to see if the same point has been reached before. The standard method for handling such situations is to compute an array of the already-visited values. For example, consider again the following query that searches a table graph using a link field:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">search_graph</span><span class="p">(...</span> <span class="p">,</span> <span class="n">depth</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="p">...</span> <span class="p">,</span> <span class="mi">0</span>
    <span class="k">FROM</span> <span class="p">...</span>
  <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span> <span class="p">...</span> <span class="p">,</span> <span class="n">sg</span><span class="p">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">FROM</span> <span class="p">...</span> <span class="p">,</span> <span class="n">search_graph</span> <span class="n">sg</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">search_graph</span><span class="p">;</span></code></pre></figure>

<p>The simple query example is:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-with-query-cycle-link-relation.sql"> </script>

<p>This query will loop if the link relationships contain cycles. Jika dijalankan hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="k">recursive</span> <span class="n">managed_by</span><span class="p">(</span><span class="n">manager_id</span><span class="p">,</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>      <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="mi">0</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">our_manager</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">UNION</span> <span class="k">ALL</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                 <span class="n">man</span><span class="p">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>          <span class="k">from</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>                   <span class="k">join</span> <span class="n">managed_by</span> <span class="n">man</span> <span class="k">on</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">man</span><span class="p">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>      <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">managed_by</span><span class="p">;</span>
 <span class="n">manager_id</span> <span class="o">|</span> <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span> <span class="n">depth</span> 
<span class="c1">------------+-------------+-------------+-------</span>
            <span class="o">|</span>         <span class="mi">100</span> <span class="o">|</span> <span class="n">Steven</span>      <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">102</span> <span class="o">|</span> <span class="n">Lex</span>         <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">102</span> <span class="o">|</span>         <span class="mi">103</span> <span class="o">|</span> <span class="n">Alexander</span>   <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">103</span> <span class="o">|</span>         <span class="mi">104</span> <span class="o">|</span> <span class="n">Bruce</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">103</span> <span class="o">|</span>         <span class="mi">105</span> <span class="o">|</span> <span class="n">David</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">103</span> <span class="o">|</span>         <span class="mi">106</span> <span class="o">|</span> <span class="n">Valli</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">122</span> <span class="o">|</span> <span class="n">Payam</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">123</span> <span class="o">|</span> <span class="n">Shanta</span>      <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">124</span> <span class="o">|</span> <span class="n">Kevin</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">120</span> <span class="o">|</span>         <span class="mi">125</span> <span class="o">|</span> <span class="n">Julia</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">120</span> <span class="o">|</span>         <span class="mi">126</span> <span class="o">|</span> <span class="n">Irene</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">120</span> <span class="o">|</span>         <span class="mi">127</span> <span class="o">|</span> <span class="n">James</span>       <span class="o">|</span>     <span class="mi">0</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">146</span> <span class="o">|</span> <span class="n">Karen</span>       <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">145</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">124</span> <span class="o">|</span> <span class="n">Kevin</span>       <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">123</span> <span class="o">|</span> <span class="n">Shanta</span>      <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">122</span> <span class="o">|</span> <span class="n">Payam</span>       <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">121</span> <span class="o">|</span> <span class="n">Adam</span>        <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">120</span> <span class="o">|</span> <span class="n">Matthew</span>     <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">114</span> <span class="o">|</span> <span class="n">Den</span>         <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">102</span> <span class="o">|</span> <span class="n">Lex</span>         <span class="o">|</span>     <span class="mi">1</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>     <span class="mi">1</span>
<span class="p">(</span><span class="mi">315</span> <span class="k">rows</span><span class="p">)</span>
</code></pre></div></div>

<p>Because we require a “depth” output, just changing <code class="language-plaintext highlighter-rouge">UNION ALL</code> to <code class="language-plaintext highlighter-rouge">UNION</code> would not eliminate the looping. Instead we need to recognize whether we have reached the same row again while following a particular path of links. We add two columns <code class="language-plaintext highlighter-rouge">is_cycle</code> and <code class="language-plaintext highlighter-rouge">path</code> to the loop-prone query:</p>

<script src="https://gist.github.com/dimMaryanto93/7ae7632f9418feb724bc431eff412a3f.js?file=04f-with-query-cycle-link-relation-path.sql"> </script>

<p>Jika dijalankan maka hasilnya seperti berikut:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hr</span><span class="o">=#</span> <span class="k">with</span> <span class="k">recursive</span> <span class="n">managed_by</span><span class="p">(</span><span class="n">manager_id</span><span class="p">,</span> <span class="n">employee_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">is_cycle</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">as</span>
<span class="n">hr</span><span class="o">-#</span>   <span class="p">(</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">select</span> <span class="n">our_manager</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">our_manager</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="mi">0</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="k">false</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">ARRAY</span> <span class="p">[</span><span class="n">our_manager</span><span class="p">.</span><span class="n">employee_id</span><span class="p">]</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">from</span> <span class="n">employees</span> <span class="n">our_manager</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">UNION</span> <span class="k">ALL</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">man</span><span class="p">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="n">path</span><span class="p">),</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>             <span class="n">path</span> <span class="o">||</span> <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">from</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>               <span class="k">join</span> <span class="n">managed_by</span> <span class="n">man</span> <span class="k">on</span> <span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">man</span><span class="p">.</span><span class="n">employee_id</span><span class="p">)</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>       <span class="k">where</span> <span class="k">NOT</span> <span class="n">is_cycle</span>
<span class="n">hr</span><span class="p">(</span><span class="o">#</span>   <span class="p">)</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">select</span> <span class="o">*</span>
<span class="n">hr</span><span class="o">-#</span> <span class="k">from</span> <span class="n">managed_by</span><span class="p">;</span>
 <span class="n">manager_id</span> <span class="o">|</span> <span class="n">employee_id</span> <span class="o">|</span> <span class="n">first_name</span>  <span class="o">|</span> <span class="n">depth</span> <span class="o">|</span> <span class="n">is_cycle</span> <span class="o">|</span>       <span class="n">path</span>        
<span class="c1">------------+-------------+-------------+-------+----------+-------------------</span>
            <span class="o">|</span>         <span class="mi">100</span> <span class="o">|</span> <span class="n">Steven</span>      <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">101</span> <span class="o">|</span> <span class="n">Neena</span>       <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">101</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">102</span> <span class="o">|</span> <span class="n">Lex</span>         <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">102</span><span class="p">}</span>
        <span class="mi">102</span> <span class="o">|</span>         <span class="mi">103</span> <span class="o">|</span> <span class="n">Alexander</span>   <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">103</span><span class="p">}</span>
        <span class="mi">101</span> <span class="o">|</span>         <span class="mi">205</span> <span class="o">|</span> <span class="n">Shelley</span>     <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">205</span><span class="p">}</span>
        <span class="mi">205</span> <span class="o">|</span>         <span class="mi">206</span> <span class="o">|</span> <span class="n">William</span>     <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">206</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">201</span> <span class="o">|</span> <span class="n">Michael</span>     <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">201</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">149</span> <span class="o">|</span> <span class="n">Eleni</span>       <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">149</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">148</span> <span class="o">|</span> <span class="n">Gerald</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">148</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">147</span> <span class="o">|</span> <span class="n">Alberto</span>     <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">147</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">146</span> <span class="o">|</span> <span class="n">Karen</span>       <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">146</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">145</span> <span class="o">|</span> <span class="n">John</span>        <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">145</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">124</span> <span class="o">|</span> <span class="n">Kevin</span>       <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">124</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">123</span> <span class="o">|</span> <span class="n">Shanta</span>      <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">123</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">122</span> <span class="o">|</span> <span class="n">Payam</span>       <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">122</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">121</span> <span class="o">|</span> <span class="n">Adam</span>        <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">121</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">120</span> <span class="o">|</span> <span class="n">Matthew</span>     <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">120</span><span class="p">}</span>
        <span class="mi">100</span> <span class="o">|</span>         <span class="mi">114</span> <span class="o">|</span> <span class="n">Den</span>         <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">f</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">114</span><span class="p">}</span>
<span class="p">(</span><span class="mi">315</span> <span class="k">rows</span><span class="p">)</span>
<span class="n">hr</span><span class="o">=#</span>     
</code></pre></div></div>

        
        <div class="text-right">
          <!--  -->












<nav>
  <ul class="pagination text-right">
    <!-- goto first page -->
    <li id="first_post" class="page-item">
      
      <a href="/posts/rdbms/postgresql/01-silabus-psql"  class="" title="Silabus - PostgreSQL: Pemula sampai Mahir">
        First page
      </a>
      
    </li>
    <li id="previous_page" class="page-item">
      
      <a href="/posts/rdbms/postgresql/sql/select/04e-combining-queries" class="" 
        title="Combining Queries (UNION, INTERSECT, EXCEPT)
">
        <i class="fas fa-chevron-left"></i>
      </a>
       
    </li>
    <li class="page-item">
      <a href="#" class=" disabled">
        Page 27 to 38
      </a>
    </li>
    <li id="next_page" class="page-item">
      
      <a href="/posts/rdbms/postgresql/sql/select/04g-quis-section-2" class="" 
        title="Time your practice (part 2)
">
        <i class="fas fa-chevron-right"></i>
      </a>
      
    </li>
    <li id="last_post" class="page-item">
      
      <a href="/posts/rdbms/postgresql/sql/tcl/06a-basic-tcl"  class="" title="Getting started with Transaction Control (TCL)">
        Last page
      </a>
      
    </li>
  </ul>
</nav>

<a href="#page-title" class="back-to-top">Back to top &uarr;</a>
        </div>
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#postgresql" class="page__taxonomy-item p-category" rel="tag">PostgreSQL</a><span class="sep">, </span>
    
      <a href="/categories/#rdbms" class="page__taxonomy-item p-category" rel="tag">RDBMS</a><span class="sep">, </span>
    
      <a href="/categories/#select" class="page__taxonomy-item p-category" rel="tag">select</a><span class="sep">, </span>
    
      <a href="/categories/#sql" class="page__taxonomy-item p-category" rel="tag">sql</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-08-08T15:50:23+07:00">August 8, 2022</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=WITH+Queries+%28Common+Table+Expressions%29%20%2Fposts%2Frdbms%2Fpostgresql%2Fsql%2Fselect%2F04f-with-queries" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Fposts%2Frdbms%2Fpostgresql%2Fsql%2Fselect%2F04f-with-queries" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2Fposts%2Frdbms%2Fpostgresql%2Fsql%2Fselect%2F04f-with-queries" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.png" alt="">
      </div>
    
    <h3 class="archive__item-title no_toc" itemprop="headline">
      
        <a class="btn btn-sm btn-light text-nowrap" href="/posts/git/gitlab/gitlab-ci/03d-getting-started" rel="permalink">Getting started: Create and run your first Gitlab CI/CD pipeline
</a>
      
    </h3>
    
<p class="page__meta">

  
  
    <a href="/pages/cources/gitlab" target="_blank" rel="noopener noreferrer">
      <i class="fas fa-link"></i>
      GitOps with Gitlab
    </a>
    <span class="page__meta-sep"></span>
  



  
    
    <span class="page__meta-date">
      <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
      
      <time datetime="2023-06-18T15:30:55+07:00">June 18, 2023</time>
    </span>
  

  <span class="page__meta-sep"></span>

  
    
    

    <span class="page__meta-readtime">
      <i class="far fa-fw fa-clock" aria-hidden="true"></i>
      
        8 minute read
      
    </span>
  
    

</p>

        
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.png" alt="">
      </div>
    
    <h3 class="archive__item-title no_toc" itemprop="headline">
      
        <a class="btn btn-sm btn-light text-nowrap" href="/posts/git/gitlab/gitlab-ci/03c-setup-gitlab-ci" rel="permalink">Settings up Gitlab CI (on-premise)
</a>
      
    </h3>
    
<p class="page__meta">

  
  
    <a href="/pages/cources/gitlab" target="_blank" rel="noopener noreferrer">
      <i class="fas fa-link"></i>
      GitOps with Gitlab
    </a>
    <span class="page__meta-sep"></span>
  



  
    
    <span class="page__meta-date">
      <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
      
      <time datetime="2023-06-17T21:12:16+07:00">June 17, 2023</time>
    </span>
  

  <span class="page__meta-sep"></span>

  
    
    

    <span class="page__meta-readtime">
      <i class="far fa-fw fa-clock" aria-hidden="true"></i>
      
        8 minute read
      
    </span>
  
    

</p>

        
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.png" alt="">
      </div>
    
    <h3 class="archive__item-title no_toc" itemprop="headline">
      
        <a class="btn btn-sm btn-light text-nowrap" href="/posts/git/gitlab/gitlab-ci/03b-introduction-gitlab-ci" rel="permalink">Introduction of Gitlab DevSecOps Platform
</a>
      
    </h3>
    
<p class="page__meta">

  
  
    <a href="/pages/cources/gitlab" target="_blank" rel="noopener noreferrer">
      <i class="fas fa-link"></i>
      GitOps with Gitlab
    </a>
    <span class="page__meta-sep"></span>
  



  
    
    <span class="page__meta-date">
      <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
      
      <time datetime="2023-06-17T20:36:43+07:00">June 17, 2023</time>
    </span>
  

  <span class="page__meta-sep"></span>

  
    
    

    <span class="page__meta-readtime">
      <i class="far fa-fw fa-clock" aria-hidden="true"></i>
      
        2 minute read
      
    </span>
  
    

</p>

        
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.png" alt="">
      </div>
    
    <h3 class="archive__item-title no_toc" itemprop="headline">
      
        <a class="btn btn-sm btn-light text-nowrap" href="/posts/git/gitlab/gitlab-ci/03a-what-is-cicd" rel="permalink">What is Continues Integration/Continues Delivery (CI/CD)?
</a>
      
    </h3>
    
<p class="page__meta">

  
  
    <a href="/pages/cources/gitlab" target="_blank" rel="noopener noreferrer">
      <i class="fas fa-link"></i>
      GitOps with Gitlab
    </a>
    <span class="page__meta-sep"></span>
  



  
    
    <span class="page__meta-date">
      <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
      
      <time datetime="2023-06-17T16:52:30+07:00">June 17, 2023</time>
    </span>
  

  <span class="page__meta-sep"></span>

  
    
    

    <span class="page__meta-readtime">
      <i class="far fa-fw fa-clock" aria-hidden="true"></i>
      
        6 minute read
      
    </span>
  
    

</p>

        
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

<script>
function showCourceContent(data){
  if(data) {
    $('body').removeClass('wide');
    $('#cource_contents').show();
  } else {
    $('body').addClass('wide');
    $('#cource_contents').hide();
  }
}

</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://facebook.com/dimmaryanto93/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/dimmaryanto93" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://instagram.com/dimmaryanto93" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@DimasMaryanto" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Dimas maryanto. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
